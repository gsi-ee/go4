include Makefile.config
Go4_Makefile_Rules = included

GO4PACKAGE = go4threadmanager

GO4BASE_LIBNAME = $(LIB_PREFIX)Go4Base
GO4BASE_LIB     = $(GO4DLLPATH)/$(GO4BASE_LIBNAME).$(DllSuf)

THRDMNGR_LIBNAME= $(LIB_PREFIX)Go4ThreadManager
THRDMNGR_LIB    = $(GO4DLLPATH)/$(THRDMNGR_LIBNAME).$(DllSuf)

BUILDGO4LIBS = $(GO4BASE_LIB) \
               $(THRDMNGR_LIB)

MODULES  = Go4Exceptions Go4LockGuard Go4Log Go4ThreadManager

EXMODULES = Go4ThreadManagerExample

all::       libs

.PHONY:         all libs \
                clean clean-obj package \
                $(patsubst %,all-%,$(MODULES)) \
                $(patsubst %,clean-%,$(MODULES)) \
                $(patsubst %,clean-obj-%,$(MODULES))

include $(patsubst %,%/Module.mk,$(MODULES))

include $(patsubst %,%/Makefile, $(EXMODULES))

build/dummy.d: Makefile $(ALLHDRS) $(GO4MAP) 
	@(if [ ! -f $@ ] ; then touch $@; fi)
	@(if [ ! -f lib ] ; then mkdir -p lib; fi)
	@(if [ ! -f bin ] ; then mkdir -p bin; fi)

$(GO4MAP):
	@(if [ ! -f $@ ] ; then touch $@; fi)

libs:           $(BUILDGO4LIBS)    

examples:       $(patsubst %,all-%,$(EXMODULES)) $(EXAMPLEEXECS)

clean::   $(patsubst %,clean-%,$(MODULES))
	@rm -f $(GO4MAP)
	@$(CleanLib) $(GO4BASE_LIBNAME) $(GO4DLLPATH)
	@echo "Clean go4 threadmanager done"

clean-obj: $(patsubst %,clean-obj-%,$(MODULES))
	@$(CleanLib) $(GO4BASE_LIBNAME) $(GO4DLLPATH)
	@echo "Clean go4 threadmanager object files done"

GO4BASE_O = $(LOCKGRD_O) $(LOCKGRD_DO) \
            $(GO4LOG_O) $(GO4LOG_DO) \
            $(EXCEPT_O)

GO4BASE_LINKDEFS = $(LOCKGRD_LINKDEF) \
                   $(GO4LOG_LINKDEF) \
                   $(COMBASE_LINKDEF) \
                   $(STATBASE_LINKDEF) \
                   $(CONDBASE_LINKDEF)

$(GO4BASE_LIB):   $(GO4BASE_O)
		@$(MakeLibrary) $(GO4BASE_LIBNAME) "$(GO4BASE_O)" $(GO4DLLPATH) "$(GO4BASE_LINKDEFS)" "$(BASIC_LIB_DEP)"

$(THRDMNGR_LIB):   $(THRDMNGR_O) $(THRDMNGR_DO)
		@$(MakeLibrary) $(THRDMNGR_LIBNAME) "$(THRDMNGR_O) $(THRDMNGR_DO)" $(GO4DLLPATH) $(THRDMNGR_LINKDEF) "$(GO4BASE_LIB) $(BASIC_LIB_DEP)"

Go4_Makefile_Rules =
include Makefile.rules

ifeq ($(findstring $(MAKECMDGOALS), $(FASTRULES)),)
-include build/dummy.d
endif
